<ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '5px',fullScreenBackdrop:true }"></ngx-loading>
<div class="row">
  <div class="col-md-12">
    <!-- list -->
    <div [class]="isDark? 'tile theme-dark' : 'tile theme-light'">
      <!-- ¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬± -->
      <!-- list -->
      <div [class]="isDark? 'tile theme-dark' : 'tile theme-light'" *ngIf="currentView === 'list'">
        <!-- üîπ HEADER -->
        <div class="user-header d-flex justify-content-between align-items-center p-3 shadow-sm rounded-3">
          <!-- üîπ Titre -->
          <div class="d-flex align-items-center gap-2">
            <h5 class="fw-bold mb-0 text-dark">
              Liste des reclamations
            </h5>
            <span class="badge-count">{{ paginatedList.length }}</span>
          </div>
          <!-- üîπ Outils : recherche + boutons -->
          <div class="d-flex align-items-center gap-2 flex-wrap justify-content-end">
            <!-- üîç Barre de recherche -->
            <div class="search-wrapper d-flex align-items-center">
              <i class="mdi mdi-magnify search-icon"></i>
              <input type="text" [(ngModel)]="searchFilterText" placeholder="Rechercher ici..."
                (input)="reclamationFiltres()" class="search-input" />
            </div>
            <!-- üß© Bouton filtre -->

            <div class="row gx-1 align-items-center" style="margin-right: 5px;">
              <div class="col-auto">
                <button class="btn_refresh" (click)="Search()" title="Rafraichir">
                  <i class="mdi mdi-refresh fs-20"></i>
                </button>
              </div>
            </div>
            <!-- ‚ûï Bouton ajout -->
            <button class="btn btn-dark d-flex align-items-center gap-1 px-3" data-backdrop="static" data-toggle="modal"
              data-target="#reclamationModal" (click)="showAddForm()">
              <i class="mdi mdi-plus"></i>
              <span>Faire une reclamation</span>
            </button>
          </div>
        </div>

        <div class="table-card">
          <div class="table-responsive">
            <table class="table align-middle table-hover table-striped">
              <thead class="table-light">
                <tr>
                  <th>
                    <!--  <div class="animated-checkbox">
                      <label>
                        <input type="checkbox" [(ngModel)]="selectAll" (change)="toggleSelectAll()" />
                        <span class="label-text"></span>
                      </label>
                    </div> -->
                  </th>
                  <th>N¬∞</th>
                  <th>Date</th>
                  <th>Visiteur</th>
                  <th>T√©lephone</th>
                  <th>Description</th>
                  <th>Statut</th>
                  <th class="text-center action-buttons">Options</th>
                </tr>
              </thead>
              <tbody>
                <tr
                  *ngFor="let reclamation of paginatedList | paginate: {itemsPerPage: pageSize, totalItems: totalPages, currentPage: page}">
                  <td>
                    <div class="animated-checkbox">
                      <label>
                        <input type="checkbox" [(ngModel)]="reclamation.selected" (change)="toggleSelectOne()" />
                        <span class="label-text"></span>
                      </label>
                    </div>
                  </td>
                  <td>{{ reclamation.id }}</td>
                  <td>{{ reclamation.created_at | date:'dd/MM/yyyy HH:mm' }}</td>
                  <td>{{ reclamation?.visiteur?.nomComplet }}</td>
                  <td>{{ reclamation?.visiteur?.numeroTelephone }}</td>
                  <td [innerHTML]="reclamation.texte"></td>
                  <td>
                    <span class="badge" *ngIf="this.reclamation.statut ==='EN_COURS'" style="color: goldenrod;">En cours
                      d'investigation</span>
                    <span class="badge" *ngIf="this.reclamation.statut ==='Retirer'"
                      style="color: green;">Restitu√©</span>
                  </td>

                  <td class="text-center action-buttons">
                    <div class="d-flex justify-content-center align-items-center gap-2 flex-wrap">
                      <button class="btn btn-light btn-icon" title="Modifier" data-backdrop="static" data-toggle="modal"
                        data-target="#reclamationModal" (click)="showEditForm(reclamation)">
                        <img src="assets/icons/mdi/edit.png" alt="Modifier" class="icon-btn" />
                      </button>

                      <button class="btn btn-light btn-icon" title="Supprimer" (click)="showDeleteDialog(reclamation)"
                        data-backdrop="static" data-bs-toggle="modal" data-bs-target="#deleteModal">
                        <img src="assets/icons/mdi/delete.png" alt="Supprimer" class="icon-btn" />
                      </button>
                      <button *ngIf="this.reclamation.statut ==='EN_COURS'" class="btn btn-outline-success btn-sm"
                        data-bs-toggle="modal" data-bs-target="#restoreModal"
                        (click)="showRecupererDialog(reclamation)">
                        <i class="mdi mdi-backup-restore"> Restituer</i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- üîπ PAGINATION -->
          <pagination-controls (pageChange)="onPageChange($event)" previousLabel="¬´ Pr√©c√©dent" nextLabel="Suivant ¬ª"
            [autoHide]="true">
          </pagination-controls>
          <!-- üîπ PAGINATION DYNAMIQUE -->
          <!--  <div class="pagination-wrapper d-flex justify-content-between align-items-center mt-3 p-2 border-top">
            <div class="d-flex align-items-center gap-2">
              <button class="btn btn-outline-secondary btn-sm" [disabled]="currentPage === 1" (click)="previousPage()">
                <i class="mdi mdi-chevron-left"></i> Pr√©c√©dent
              </button>
              <ng-container *ngFor="let page of [].constructor(totalPages); let i = index">
                <button class="btn btn-sm"
                  [ngClass]="currentPage === i + 1 ? 'btn-primary text-white' : 'btn-outline-secondary'"
                  (click)="currentPage = i + 1; updatePaginatedList()">
                  {{ i + 1 }}
                </button>
              </ng-container>

              <button class="btn btn-outline-secondary btn-sm" [disabled]="currentPage === totalPages"
                (click)="nextPage()">
                Suivant <i class="mdi mdi-chevron-right"></i>
              </button>
            </div>

            <div class="text-muted small">
              Page {{ currentPage }} sur {{ totalPages }}
            </div>
          </div>
        </div> -->
        </div>
        <!-- /list -->
        <!-- ¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬± -->

      </div>
      <!-- /list -->

      <!-- add reclamation modal -->
      <div class="container demo" *ngIf="currentView === 'add2'">
        <div class="modal fade" id="reclamationModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2"
          aria-hidden="true">

          <!-- MODAL DIALOG LARGE -->
          <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 700px; width: 100%;">
            <!-- üëà Largeur augment√©e -->

            <div class="modal-content" [style]="{'background-color': isDark ? '#1f1f1f' : '#FFFFFF'}">

              <form #formAddReclamation="ngForm">

                <!-- HEADER -->
                <div class="modal-header">
                  <h5 class="modal-title">
                    {{ reclamation.id ? 'Modifier une r√©clamation' : 'R√©clamation' }}
                  </h5>

                  <button type="button" class="close" data-dismiss="modal" aria-label="Close" #closeAddElementDialog>
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>

                <!-- BODY -->
                <div class="modal-body">

                  <div class="form-group row">

                    <!-- VISITEUR -->
                    <div class="col-lg-6 mb-3">
                      <div class="form-group has-success align-left ft-w-b">
                        <label [class]="isDark?'form-control-label c-cab-1':'form-control-label c-cab-2'">
                          Choisir un visiteur
                        </label>

                        <div class="select select-add">
                          <p-dropdown [options]="visiteurs" [(ngModel)]="reclamation.visiteur_id" [showClear]="true"
                            [filter]="true" filterBy="nomComplet,numeroTelephone" optionValue="id"
                            placeholder="Choisir un visiteur" styleClass="wd_100 initialwd">

                            <!-- S√©lectionn√© -->
                            <ng-template let-visiteur pTemplate="selectedItem">
                              <span *ngIf="visiteur">
                                {{ visiteur.nomComplet }} / {{ visiteur.numeroTelephone }}
                              </span>
                            </ng-template>

                            <!-- Liste -->
                            <ng-template let-visiteur pTemplate="item">
                              <span>{{ visiteur.nomComplet }} / {{ visiteur.numeroTelephone }}</span>
                            </ng-template>

                          </p-dropdown>

                          <div class="arrow" [class]="isDark?'option-select-d':'option-select-w'"></div>
                        </div>
                      </div>
                    </div>

                    <!-- TYPE INCIDENT -->
                    <div class="col-lg-6 mb-3">
                      <div class="form-group has-success align-left ft-w-b">
                        <label [class]="isDark?'form-control-label c-cab-1':'form-control-label c-cab-2'">
                          Type d‚Äôincident *
                        </label>

                        <div class="select select-add">
                          <p-dropdown [options]="typesIncidents" [(ngModel)]="reclamation.typeIncident"
                            optionLabel="libelle" optionValue="id" placeholder="Choisir le type d‚Äôincident"
                            styleClass="wd_100 initialwd">
                          </p-dropdown>

                          <div class="arrow" [class]="isDark?'option-select-d':'option-select-w'"></div>
                        </div>
                      </div>
                    </div>

                    <!-- LABEL NIVEAU GRAVIT√â -->
                    <div class="col-lg-6 mb-3">
                      <div class="form-group has-success align-left ft-w-b">
                        <label [class]="isDark?'form-control-label c-cab-1':'form-control-label c-cab-2'">
                          Niveau de gravit√© <span class="text-danger">*</span>
                        </label>
                      </div>
                    </div>

                    <!-- RADIO NIVEAU GRAVIT√â -->
                    <div class="col-lg-76mb-3">
                      <div class="d-flex flex-row align-items-center flex-wrap" style="gap: 25px;">

                        <div *ngFor="let niveau of niveauxGravites" class="d-flex align-items-center gap-2">

                          <p-radioButton name="niveauxGravite" [value]="niveau.id"
                            [(ngModel)]="reclamation.niveauxGravite">
                          </p-radioButton>

                          <span class="fw-bold" [ngClass]="{
                        'text-success': niveau.libelle === 'Faible',
                        'text-warning': niveau.libelle === 'Mod√©r√©',
                        'text-danger': niveau.libelle === 'Critique'
                      }">
                            {{ niveau.libelle }}
                          </span>

                        </div>

                      </div>
                    </div>

                  </div>

                  <!-- TEXTAREA -->
                  <div class="col-lg-12 p-right-0">
                    <div class="form-group align-left ft-w-b">
                      <!-- Label avec style sombre/claire -->
                      <label [class]="isDark ? 'form-control-label c-cab-1' : 'form-control-label c-cab-2'"
                        for="description"> Description <span class="text-danger">*</span>
                      </label>
                      <!-- Barre d'outils -->
                      <ngx-editor-menu [editor]="editor"></ngx-editor-menu>
                      <!-- √âditeur de texte riche -->
                      <ngx-editor name="texte" outputFormat="html" [spellcheck]="true" [editor]="editor"
                        [(ngModel)]="reclamation.texte" placeholder="D√©crivez ici le contenu de l'incident" required>
                      </ngx-editor>
                      <!-- Message d'erreur si vide -->

                    </div>
                  </div>


                </div>

                <!-- FOOTER -->
                <div class="modal-footer d-flex flex-column">
                  <button [disabled]="!formAddReclamation.valid" class="btn btn-login btn-block btnn_save"
                    (click)="reclamation.id ? Update() : Save()">

                    <img src="assets/images/save.png" alt="" class="icon_save">
                    Enregistrer et terminer
                  </button>

                  <label class="lab_reset mt-2" data-dismiss="modal" aria-label="Close">
                    Fermer
                  </label>
                </div>

              </form>

            </div>


            <div class="modal-body">
              <form #formAddReclamation="ngForm">
                <div class="progress-container mb-4">
                  <div class="step" [class.active]="step >= 1">
                    <div class="circle">1</div>
                    <span>Informations personnelles</span>
                  </div>
                  <div class="line" [class.filled]="step >= 2"></div>
                  <div class="step" [class.active]="step >= 2">
                    <div class="circle">2</div>
                    <span>Contacts et Pi√®ces d‚Äôidentit√©</span>
                  </div>
                  <div class="line" [class.filled]="step >= 3"></div>
                  <div class="step" [class.active]="step >= 3">
                    <div class="circle">3</div>
                    <span>Informations g√©n√©rales</span>
                  </div>
                  <div class="line" [class.filled]="step >= 4"></div>
                  <div class="step" [class.active]="step >= 4">
                    <div class="circle">4</div>
                    <span>R√©capitulatif</span>
                  </div>
                </div>

                <!-- √âtape 1 : Informations du visiteur -->
                <div *ngIf="step === 1" class="step-form fade-in">
                  <div class="col-md-12 col-lg-12 p-right-0">
                    <div [class]="isDark? 'card cust_card_d':'card cust_card_w'">
                      <div class="card-block">
                        <div class="row mb-l20" *ngIf="!isNumberPhone">
                          <div class="col-12 d-flex justify-content-center pt-5">
                            <div class="search-box text-center">
                              <h5 class="text-danger mb-4">Veuillez renseigner le num√©ro de t√©l√©phone.</h5>
                              <form #elementForm="ngForm">
                                <div class="col-lg-12 p-right-0">
                                  <div class="form-group has-success align-left ft-w-b">
                                    <div class="phone-input-container">
                                      <!-- Dropdown indicatif -->
                                      <p-dropdown [options]="indicatifsNums" name="indicatif" [(ngModel)]="indicatif1"
                                        optionLabel="label" placeholder="Indicatif" [filter]="true" [showClear]="false"
                                        [filterBy]="'label'" styleClass="wd_100">
                                        <!-- Champ s√©lectionn√© : drapeau + indicatif -->
                                        <ng-template let-item pTemplate="selectedItem">
                                          <span *ngIf="item">{{item.flag}} {{item.value}}</span>
                                        </ng-template>
                                        <!-- Menu d√©roulant : drapeau + pays + indicatif -->
                                        <ng-template let-item pTemplate="item">
                                          <span>{{item.flag}} {{item.label}} ({{item.value}})</span>
                                        </ng-template>
                                      </p-dropdown>
                                      <!-- Input num√©ro -->
                                      <input
                                        [class]="isDark? 'form-control form-control-d is-valid' : 'form-control form-control-w is-valid'"
                                        (keyup.enter)="searchVisiteurByNumber(searchParam.query)" id="numeroTelephone"
                                        name="numeroTelephone" type="tel" placeholder="Ex: 0707070707"
                                        [(ngModel)]="searchParam.query" required>
                                    </div>
                                  </div>
                                </div>
                              </form>
                              <!-- Boutons en bas -->
                              <div class="d-flex justify-content-center gap-3 mt-4">
                                <button (click)="showList()" class="btn btn-outline-danger btn-sm rounded-pill">
                                  <i class="mdi mdi-close"></i> Fermer
                                </button>

                                <button class="btn btn-dark d-flex align-items-center gap-1 px-3"
                                  [disabled]="!elementForm.form.valid"
                                  (click)="searchVisiteurByNumber(searchParam.query)"><i
                                    class="mdi mdi-magnify"></i><span>Chercher</span>
                                </button>

                              </div>

                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- √âtape 2 : Informations du visiteur -->
                <div *ngIf="step === 2" class="step-form fade-in">
                  <div class="col-md-12 col-lg-12 p-right-0">
                    <div [class]="isDark? 'card cust_card_d':'card cust_card_w'">
                      <div class="card-block">

                        <div class="row mb-l20" *ngIf="isNumberPhone">

                          <!-- VISITEUR -->
                          <div class="col-lg-6 mb-3">
                            <div class="form-group has-success align-left ft-w-b">
                              <label [class]="isDark?'form-control-label c-cab-1':'form-control-label c-cab-2'">
                                Choisir un visiteur
                              </label>

                              <div class="select select-add">
                                <p-dropdown [options]="visiteurs" [(ngModel)]="reclamation.visiteur_id"
                                  [showClear]="true" [filter]="true" filterBy="nomComplet,numeroTelephone"
                                  optionValue="id" placeholder="Choisir un visiteur" styleClass="wd_100 initialwd">

                                  <!-- S√©lectionn√© -->
                                  <ng-template let-visiteur pTemplate="selectedItem">
                                    <span *ngIf="visiteur">
                                      {{ visiteur.nomComplet }} / {{ visiteur.numeroTelephone }}
                                    </span>
                                  </ng-template>

                                  <!-- Liste -->
                                  <ng-template let-visiteur pTemplate="item">
                                    <span>{{ visiteur.nomComplet }} / {{ visiteur.numeroTelephone }}</span>
                                  </ng-template>

                                </p-dropdown>

                                <div class="arrow" [class]="isDark?'option-select-d':'option-select-w'"></div>
                              </div>
                            </div>
                          </div>

                          <!-- TYPE INCIDENT -->
                          <div class="col-lg-6 mb-3">
                            <div class="form-group has-success align-left ft-w-b">
                              <label [class]="isDark?'form-control-label c-cab-1':'form-control-label c-cab-2'">
                                Type d‚Äôincident *
                              </label>

                              <div class="select select-add">
                                <p-dropdown [options]="typesIncidents" [(ngModel)]="reclamation.typeIncident"
                                  optionLabel="libelle" optionValue="id" placeholder="Choisir le type d‚Äôincident"
                                  styleClass="wd_100 initialwd">
                                </p-dropdown>

                                <div class="arrow" [class]="isDark?'option-select-d':'option-select-w'"></div>
                              </div>
                            </div>
                          </div>

                          <!-- LABEL NIVEAU GRAVIT√â -->
                          <div class="col-lg-6 mb-3">
                            <div class="form-group has-success align-left ft-w-b">
                              <label [class]="isDark?'form-control-label c-cab-1':'form-control-label c-cab-2'">
                                Niveau de gravit√© <span class="text-danger">*</span>
                              </label>
                            </div>
                          </div>

                          <!-- RADIO NIVEAU GRAVIT√â -->
                          <div class="col-lg-76mb-3">
                            <div class="d-flex flex-row align-items-center flex-wrap" style="gap: 25px;">

                              <div *ngFor="let niveau of niveauxGravites" class="d-flex align-items-center gap-2">

                                <p-radioButton name="niveauxGravite" [value]="niveau.id"
                                  [(ngModel)]="reclamation.niveauxGravite">
                                </p-radioButton>

                                <span class="fw-bold" [ngClass]="{
                        'text-success': niveau.libelle === 'Faible',
                        'text-warning': niveau.libelle === 'Mod√©r√©',
                        'text-danger': niveau.libelle === 'Critique'
                      }">
                                  {{ niveau.libelle }}
                                </span>

                              </div>

                            </div>
                          </div>

                        </div>

                        <!-- TEXTAREA -->
                        <div class="col-lg-12 p-right-0">
                          <div class="form-group align-left ft-w-b">
                            <!-- Label avec style sombre/claire -->
                            <label [class]="isDark ? 'form-control-label c-cab-1' : 'form-control-label c-cab-2'"
                              for="description"> Description <span class="text-danger">*</span>
                            </label>
                            <!-- Barre d'outils -->
                            <ngx-editor-menu [editor]="editor"></ngx-editor-menu>
                            <!-- √âditeur de texte riche -->
                            <ngx-editor name="texte" outputFormat="html" [spellcheck]="true" [editor]="editor"
                              [(ngModel)]="reclamation.texte" placeholder="D√©crivez ici le contenu de l'incident"
                              required>
                            </ngx-editor>
                            <!-- Message d'erreur si vide -->

                          </div>
                        </div>

                      </div>
                    </div>
                  </div>
                </div>
                <div class="d-flex justify-content-between mt-4">
                  <button type="button" class="btn btn-dark d-flex align-items-center gap-1 px-3" (click)="step = 1">
                    <i class="mdi mdi-arrow-left me-1"></i> Pr√©c√©dent
                  </button>

                  <button [disabled]="!formAddReclamation.valid" type="button"
                    class="btn btn-dark d-flex align-items-center gap-1 px-3" (click)="step = 3">
                    <i class="mdi mdi-arrow-right me-1"></i> Suivant
                  </button>
                </div>
              </form>
            </div>
          </div>

        </div>
      </div>

      <!-- ¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬± -->
      <!-- ¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬± -->
      <div *ngIf="currentView === 'add'" [style]="{'background-color': isDark ? '#1f1f1f' : '#FFFFFF'}">
        <div class="row">
          <div class="col-md-2"></div>
          <div class="col-md-8 ta-center" style="margin-top: 30px;margin-bottom: 20px;">
            <label class="title_headtx titre_traitement mt-2" style="font-size: 20px;">Nouveau reclamation / incident
            </label>
          </div>
        </div>
        <div class="row" style="padding-bottom: 420px;">
          <div class="col-md-3"></div>
          <div class="col-md-6">
            <div class="modal-content" [style]="{'background-color': isDark ? '#1f1f1f' : '#FFFFFF'}">
              <div class="d-flex" style="margin-top: 15px;">
                <button type="button" class="close" (click)="showList()" style="margin-left: 10px;">
                  <span aria-hidden="true">
                    <i
                      [class]="isDark? 'txt-title-d mdi mdi-arrow-left-bold-circle' : 'mdi mdi-arrow-left-bold-circle'"></i>
                  </span>
                  <label [class]="isDark? 'txt-title-d ml-2': 'ml-1'" style="font-size: 14px;"> Retour</label>
                </button>
              </div>
              <div class="modal-body">
                <form #formAddReclamation="ngForm">
                  <div class="progress-container mb-4">
                    <div class="step" [class.active]="step >= 1">
                      <div class="circle">1</div>
                      <span>Rechercher le num√©ro T√©lephone</span>
                    </div>

                    <div class="line" [class.filled]="step >= 2"></div>
                    <div class="step" [class.active]="step >= 2">
                      <div class="circle">2</div>
                      <span>Informations g√©n√©rales</span>
                    </div>
                  </div>

                  <!-- √âtape 1 : Informations du visiteur -->

                  <!-- √âtape 2 : Informations du visiteur -->
                  <div class="step-form fade-in">
                    <div class="col-md-12 col-lg-12 p-right-0">
                      <div [class]="isDark? 'card cust_card_d':'card cust_card_w'">
                        <div class="card-block">
                          <div class="row mb-l20">
                          <div class="modal-body p-4">

                            <!-- üîç Zone de recherche du num√©ro -->
                            <div class="d-flex justify-content-center">
                              <div class="search-box w-100" style="max-width: 650px;">
                                <h5 class="text-danger fw-bold text-center mb-4">
                                  Veuillez renseigner le num√©ro de t√©l√©phone
                                </h5>

                                <form #elementForm="ngForm">

                                  <!-- Ligne : Dropdown + Input + Button -->
                                  <div class="d-flex align-items-center gap-2">

                                    <!-- Dropdown indicatif -->
                                    <p-dropdown
                                      [options]="indicatifsNums"
                                      name="indicatif"
                                      [(ngModel)]="indicatif1"
                                      optionLabel="label"
                                      placeholder="Indicatif"
                                      [filter]="true"
                                      [showClear]="false"
                                      [filterBy]="'label'"
                                      styleClass="wd_100 shadow-sm">
                                      <ng-template let-item pTemplate="selectedItem">
                                        <span *ngIf="item">{{ item.flag }} {{ item.value }}</span>
                                      </ng-template>
                                      <ng-template let-item pTemplate="item">
                                        <span>{{ item.flag }} {{ item.label }} ({{ item.value }})</span>
                                      </ng-template>
                                    </p-dropdown>

                                    <!-- Input num√©ro -->
                                    <input
                                      [class]="isDark ? 'form-control form-control-d is-valid shadow-sm' :
                                                        'form-control form-control-w is-valid shadow-sm'"
                                      (keyup.enter)="searchVisiteurByNumber(searchParam.query)"
                                      id="numeroTelephone"
                                      name="numeroTelephone"
                                      type="tel"
                                      placeholder="Ex: 0707070707"
                                      [(ngModel)]="searchParam.query"
                                      required
                                      class="flex-grow-1">

                                    <!-- Button -->
                                    <button
                                      class="btn btn-dark d-flex align-items-center gap-1 px-3 shadow-sm"
                                      [disabled]="!elementForm.form.valid"
                                      (click)="searchVisiteurByNumber(searchParam.query)">
                                      <i class="mdi mdi-magnify fs-5"></i>
                                    </button>

                                  </div>

                                </form>
                              </div>
                            </div>

                            <!-- üë§ Informations visiteur -->
                            <div class="info-card rounded-3 shadow-sm p-4 mt-5" *ngIf="isNumberPhone">
                              <h3 class="section-title fw-bold mb-4">
                                <i class="mdi mdi-account-badge-outline text-primary me-2"></i>
                                Informations du visiteur
                              </h3>

                              <div class="row g-4">

                                <!-- Colonne gauche -->
                                <div class="col-md-6">
                                  <div class="info-row">
                                    <i class="mdi mdi-account text-primary"></i>
                                    <span class="label">Nom complet :</span>
                                    <span class="value">{{ visiteur?.nomComplet }}</span>
                                  </div>

                                  <div class="info-row">
                                    <i class="mdi mdi-gender-male-female text-primary"></i>
                                    <span class="label">Sexe :</span>
                                    <span class="value">{{ visiteur?.sexe }}</span>
                                  </div>

                                  <div class="info-row">
                                    <i class="mdi mdi-card-account-details-outline text-primary"></i>
                                    <span class="label">Type de pi√®ce :</span>
                                    <span class="value">{{ visiteur?.typePiece }}</span>
                                  </div>

                                  <div class="info-row">
                                    <i class="mdi mdi-card-text-outline text-primary"></i>
                                    <span class="label">N¬∞ de pi√®ce :</span>
                                    <span class="value">{{ visiteur?.numeroPiece }}</span>
                                  </div>
                                </div>

                                <!-- Colonne droite -->
                                <div class="col-md-6">
                                  <div class="info-row">
                                    <i class="mdi mdi-phone text-primary"></i>
                                    <span class="label">T√©l√©phone :</span>
                                    <span class="value">{{ visiteur?.numeroTelephone }}</span>
                                  </div>

                                  <div class="info-row">
                                    <i class="mdi mdi-map-marker text-primary"></i>
                                    <span class="label">Adresse :</span>
                                    <span class="value">{{ visiteur?.adresse }}</span>
                                  </div>

                                  <div class="info-row">
                                    <i class="mdi mdi-briefcase-account text-primary"></i>
                                    <span class="label">Fonction :</span>
                                    <span class="value">{{ visiteur?.fonction }}</span>
                                  </div>
                                </div>

                              </div>
                            </div>

                            <!-- FORMULAIRE D‚ÄôINCIDENT -->
                            <div class="row mt-4" *ngIf="isNumberPhone">

                              <!-- Type incident -->
                              <div class="col-lg-6 mb-3">
                                <label [class]="isDark ? 'form-control-label c-cab-1' : 'form-control-label c-cab-2'">
                                  Type d‚Äôincident <span class="text-danger">*</span>
                                </label>

                                <div class="select select-add">
                                  <p-dropdown
                                    [options]="typesIncidents"
                                    name="typeIncident"
                                    [(ngModel)]="reclamation.typeIncident"
                                    optionLabel="libelle"
                                    optionValue="id"
                                    placeholder="Choisir le type d‚Äôincident"
                                    styleClass="wd_100 initialwd shadow-sm">
                                  </p-dropdown>
                                  <div class="arrow" [class]="isDark ? 'option-select-d':'option-select-w'"></div>
                                </div>
                              </div>

                              <!-- Gravit√© -->
                              <div class="col-lg-6 mb-3">
                                <label [class]="isDark ? 'form-control-label c-cab-1' : 'form-control-label c-cab-2'">
                                  Niveau de gravit√© <span class="text-danger">*</span>
                                </label>

                                <div class="d-flex flex-wrap align-items-center gap-4 mt-2">
                                  <div *ngFor="let niveau of niveauxGravites" class="d-flex align-items-center gap-2">
                                    <p-radioButton name="niveauxGravite" [value]="niveau.id"
                                                  [(ngModel)]="reclamation.niveauxGravite"></p-radioButton>

                                    <span class="fw-bold"
                                          [ngClass]="{
                                            'text-success': niveau.libelle === 'Faible',
                                            'text-warning': niveau.libelle === 'Mod√©r√©',
                                            'text-danger': niveau.libelle === 'Critique'
                                          }">
                                      {{ niveau.libelle }}
                                    </span>
                                  </div>
                                </div>
                              </div>

                            </div>

                            <!-- Description -->
                            <div class="mt-3" *ngIf="isNumberPhone">
                              <label [class]="isDark ? 'form-control-label c-cab-1':'form-control-label c-cab-2'">
                                Description <span class="text-danger">*</span>
                              </label>

                              <ngx-editor-menu [editor]="editor"></ngx-editor-menu>

                              <ngx-editor
                                name="texte"
                                outputFormat="html"
                                [spellcheck]="true"
                                [editor]="editor"
                                [(ngModel)]="reclamation.texte"
                                placeholder="D√©crivez ici le contenu de l'incident"
                                required>
                              </ngx-editor>
                            </div>

                          </div>

                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="d-flex justify-content-center gap-3 mt-4">
                      <button (click)="showList()" class="btn btn-outline-danger btn-sm rounded-pill">
                        <i class="mdi mdi-close"></i> Fermer
                      </button>

                      <button class="btn btn-dark d-flex align-items-center gap-1 px-3"
                        [disabled]="!formAddReclamation.form.valid" (click)="reclamation.id ? Update() : Save()"><i
                          class="mdi mdi-check-circle"></i><span>Enregistrer</span>
                      </button>

                    </div>

                  </div>

                </form>
              </div>

            </div>
          </div>
        </div>
      </div>
      <!-- ¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬± -->
      <!-- ¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬± -->

    </div>
  </div>



  <!-- ¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬± -->
  <!-- Modal Suppression -->
  <div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">

        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title">
            <i class="mdi mdi-delete-forever me-1"></i> Confirmer la suppression
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body text-center">
          <p class="fw-bold mb-2">Voulez-vous vraiment supprimer ?</p>
          <p class="text-muted mb-0">{{ reclamation?.visiteur?.nomComplet }}</p>
        </div>

        <div class="modal-footer d-flex justify-content-between">
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">
            Annuler
          </button>

          <button type="button" class="btn btn-danger btn-sm" (click)="DeleteReclamation()">
            Supprimer
          </button>
        </div>

      </div>
    </div>
  </div>
  <!-- ¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬± -->
  <!-- ¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬± -->
  <!-- Modal R√©cup√©ration -->
  <div class="modal fade" id="restoreModal" tabindex="-1">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">

        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">
            <i class="mdi mdi-backup-restore me-1"></i> Restaurer l'√©l√©ment
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body text-center">
          <p class="fw-bold mb-2">Voulez-vous restaurer cet √©l√©ment ?</p>
          <p class="text-muted mb-0">{{ reclamation?.visiteur?.nomComplet }}</p>
        </div>

        <div class="modal-footer d-flex justify-content-between">
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">
            Annuler
          </button>
          <button type="button" class="btn btn-success btn-sm" (click)="RetirerObjet()">
            Restituer
          </button>
        </div>

      </div>
    </div>
  </div>
  <!-- ¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬± -->