<ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '5px',fullScreenBackdrop:true }"></ngx-loading>
<div class="row" style=" padding-top: 20px;">
  <div class="col-xl-4">
  <div class="profile-card shadow-sm">
    
    <div class="profile-card-header" [class.dark]="isDark">
      <i class="mdi mdi-account-circle-outline mr-1"></i>
      Image de profil
    </div>

    <div class="profile-card-body" [class.dark]="isDark">

      <!-- Image -->
      <div class="profile-image-wrapper">
        <img 
          *ngIf="isChanged" 
          [src]="currentUser.image" 
          alt="Profil change" 
          class="profile-img"
        />
        <img 
          *ngIf="!currentUser?.image && !isChanged" 
          src="assets/images/profile/avatar1.png" 
          alt="Default" 
          class="profile-img"
        />
        <img 
          *ngIf="currentUser?.image && !isChanged" 
          [src]="currentUser?.image" 
          alt="Profil user" 
          class="profile-img"
        />
      </div>

      <!-- Info -->
      <p class="profile-note">Formats autorisés : JPG ou PNG (max 5 Mo)</p>

      <!-- Boutons -->
      <button 
        class="btn btn-upload" 
        *ngIf="!isChanged" 
        [disabled]="!roleManager.isDroitChangerPhotoUtilisateur()" 
        (click)="selectFile()">
        <i class="mdi mdi-upload mr-1"></i> Télécharger une nouvelle image
      </button>

      <div class="profile-confirm" *ngIf="isChanged">
        <i class="mdi mdi-close icon-delete" (click)="deletePhoto()"></i>
        <i class="mdi mdi-check icon-update" (click)="UpdateImage()"></i>
      </div>

    </div>
  </div>
</div>

<div class="col-xl-8">
  <div class="card mb-4 shadow-sm border-0 rounded-3">

    <!-- Header -->
    <div [class]="isDark ? 'card-header theme-dark c-cab-1' : 'card-header theme-light c-cab-2'">
      <h5 class="mb-0 d-flex align-items-center gap-2 fw-bold">
        <i class="mdi mdi-account-circle-outline"></i>
        Détails du compte
      </h5>
    </div>

    <!-- Body (Affichage simple) -->
    <div [class]="isDark ? 'card-body theme-dark' : 'card-body theme-light'">
      <div class="detail-row" *ngFor="let item of [
        { icon: 'mdi-school-outline', label: 'Profession', value: currentUser?.profession },
        { icon: 'mdi-briefcase-outline', label: 'Fonction', value: currentUser?.fonction },
        { icon: 'mdi-account-outline', label: 'Prénom', value: currentUser?.prenom },
        { icon: 'mdi-account-outline', label: 'Nom', value: currentUser?.nom },
        { icon: 'mdi-domain', label: 'Organisation', value: currentUser?.organisation },
        { icon: 'mdi-map-marker-outline', label: 'Adresse', value: currentUser?.adresse },
        { icon: 'mdi-email-outline', label: 'Adresse e-mail', value: currentUser?.email },
        { icon: 'mdi-phone-outline', label: 'Téléphone', value: currentUser?.telephone }
      ]">
        <i class="mdi" [ngClass]="item.icon"></i>
        <span class="label">{{ item.label }} :</span>
        <span class="value">{{ item.value || '--' }}</span>
      </div>
    </div>

  </div>
</div>



</div>

<!-- Modal Change Pwd Dialog -->
<div class="modal fade" id="modalChangeCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content" style="width: 330px;">
      <div class="modal-header">
        <h5 class="modal-title" id="modalCenterTitle">Changément du mot de passe</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="col-md-12 mb-1">
          <input name="oldPassword" class="form-control" [(ngModel)]="authUser.oldPassword" placeholder="Ancien mot de passe" required/>
        </div>
        <div class="col-md-12 mb-1">
          <input name="newPassword" class="form-control" [(ngModel)]="authUser.newPassword" placeholder="Nouveau mot de passe" required/>
        </div>
        <div class="col-md-12">
          <input name="confirmPassword" class="form-control" [(ngModel)]="authUser.confirmPassword" placeholder="Confirmez le mot de passe" required/>
        </div>
      </div>
      <div class="modal-footer">
        <div style="width: 100%; text-align: center;">
          <button class="btn btn-danger btn-sm mr-1" type="button" data-dismiss="modal">
            <i class="fa fa-times-circle"></i>Fermer
          </button>
          <button class="btn btn-primary btn-sm" type="button" (click)="changerPwd()">
            <i class="fa fa-check-circle"></i>Changer
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<input type="file" name="fileUpload" accept="image/*" #fileInputUpload style="visibility: hidden; height: 0px" (change)="onFileUploadChange($event)" [multiple]="false" />