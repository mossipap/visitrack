/**
 * Created by vadimdez on 28/06/16.
 */
import { Pipe, Injectable } from '@angular/core';
import * as i0 from "@angular/core";
export class FilterPipe {
    static isFoundOnWalking(value, key) {
        let walker = value;
        let found = false;
        do {
            if (walker.hasOwnProperty(key) ||
                Object.getOwnPropertyDescriptor(walker, key)) {
                found = true;
                break;
            }
        } while ((walker = Object.getPrototypeOf(walker)));
        return found;
    }
    static isNumber(value) {
        return !isNaN(parseInt(value, 10)) && isFinite(value);
    }
    /**
     * Checks function's value if type is function otherwise same value
     */
    static getValue(value) {
        return typeof value === 'function' ? value() : value;
    }
    filterByString(filter) {
        if (filter) {
            filter = filter.toLowerCase();
        }
        return (value) => !filter ||
            (value ? ('' + value).toLowerCase().indexOf(filter) !== -1 : false);
    }
    filterByBoolean(filter) {
        return (value) => Boolean(value) === filter;
    }
    filterByObject(filter) {
        return (value) => {
            for (const key in filter) {
                if (key === '$or') {
                    if (!this.filterByOr(filter.$or)(FilterPipe.getValue(value))) {
                        return false;
                    }
                    continue;
                }
                if (!value || !FilterPipe.isFoundOnWalking(value, key)) {
                    return false;
                }
                if (!this.isMatching(filter[key], FilterPipe.getValue(value[key]))) {
                    return false;
                }
            }
            return true;
        };
    }
    isMatching(filter, val) {
        switch (typeof filter) {
            case 'boolean':
                return this.filterByBoolean(filter)(val);
            case 'string':
                return this.filterByString(filter)(val);
            case 'object':
                return this.filterByObject(filter)(val);
        }
        return this.filterDefault(filter)(val);
    }
    /**
     * Filter value by $or
     */
    filterByOr(filter) {
        return (value) => {
            const length = filter.length;
            const arrayComparison = (i) => value.indexOf(filter[i]) !== -1;
            const otherComparison = (i) => this.isMatching(filter[i], value);
            const comparison = Array.isArray(value)
                ? arrayComparison
                : otherComparison;
            for (let i = 0; i < length; i++) {
                if (comparison(i)) {
                    return true;
                }
            }
            return false;
        };
    }
    /**
     * Default filterDefault function
     */
    filterDefault(filter) {
        return (value) => filter === undefined || filter == value;
    }
    transform(array, filter) {
        if (!array) {
            return array;
        }
        switch (typeof filter) {
            case 'boolean':
                return array.filter(this.filterByBoolean(filter));
            case 'string':
                if (FilterPipe.isNumber(filter)) {
                    return array.filter(this.filterDefault(filter));
                }
                return array.filter(this.filterByString(filter));
            case 'object':
                return array.filter(this.filterByObject(filter));
            case 'function':
                return array.filter(filter);
        }
        return array.filter(this.filterDefault(filter));
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.8", ngImport: i0, type: FilterPipe, deps: [], target: i0.ɵɵFactoryTarget.Pipe });
    static ɵpipe = i0.ɵɵngDeclarePipe({ minVersion: "14.0.0", version: "17.3.8", ngImport: i0, type: FilterPipe, name: "filterBy", pure: false });
    static ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.3.8", ngImport: i0, type: FilterPipe });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.8", ngImport: i0, type: FilterPipe, decorators: [{
            type: Pipe,
            args: [{
                    name: 'filterBy',
                    pure: false
                }]
        }, {
            type: Injectable
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWZpbHRlci5waXBlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2FwcC9zaGFyZWQvbmd4LWZpbHRlci1waXBlL25neC1maWx0ZXIucGlwZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7R0FFRztBQUNILE9BQU8sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFpQixNQUFNLGVBQWUsQ0FBQzs7QUFPaEUsTUFBTSxPQUFPLFVBQVU7SUFDckIsTUFBTSxDQUFDLGdCQUFnQixDQUFDLEtBQVUsRUFBRSxHQUFRO1FBQzFDLElBQUksTUFBTSxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbEIsR0FBRyxDQUFDO1lBQ0YsSUFDRSxNQUFNLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQztnQkFDMUIsTUFBTSxDQUFDLHdCQUF3QixDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsRUFDNUMsQ0FBQztnQkFDRCxLQUFLLEdBQUcsSUFBSSxDQUFDO2dCQUNiLE1BQU07WUFDUixDQUFDO1FBQ0gsQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRTtRQUVuRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRCxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQVU7UUFDeEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBVTtRQUN4QixPQUFPLE9BQU8sS0FBSyxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztJQUN2RCxDQUFDO0lBRU8sY0FBYyxDQUFDLE1BQWM7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UUFDRCxPQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ2xELENBQUM7dUdBN0hVLFVBQVU7cUdBQVYsVUFBVTsyR0FBVixVQUFVOzsyRkFBVixVQUFVO2tCQUx0QixJQUFJO21CQUFDO29CQUNKLElBQUksRUFBRSxVQUFVO29CQUNoQixJQUFJLEVBQUUsS0FBSztpQkFDWjs7a0JBQ0EsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSB2YWRpbWRleiBvbiAyOC8wNi8xNi5cbiAqL1xuaW1wb3J0IHsgUGlwZSwgSW5qZWN0YWJsZSwgUGlwZVRyYW5zZm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5AUGlwZSh7XG4gIG5hbWU6ICdmaWx0ZXJCeScsXG4gIHB1cmU6IGZhbHNlXG59KVxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEZpbHRlclBpcGUgaW1wbGVtZW50cyBQaXBlVHJhbnNmb3JtIHtcbiAgc3RhdGljIGlzRm91bmRPbldhbGtpbmcodmFsdWU6IGFueSwga2V5OiBhbnkpIHtcbiAgICBsZXQgd2Fsa2VyID0gdmFsdWU7XG4gICAgbGV0IGZvdW5kID0gZmFsc2U7XG4gICAgZG8ge1xuICAgICAgaWYgKFxuICAgICAgICB3YWxrZXIuaGFzT3duUHJvcGVydHkoa2V5KSB8fFxuICAgICAgICBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHdhbGtlciwga2V5KVxuICAgICAgKSB7XG4gICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfSB3aGlsZSAoKHdhbGtlciA9IE9iamVjdC5nZXRQcm90b3R5cGVPZih3YWxrZXIpKSk7XG5cbiAgICByZXR1cm4gZm91bmQ7XG4gIH1cblxuICBzdGF0aWMgaXNOdW1iZXIodmFsdWU6IGFueSkge1xuICAgIHJldHVybiAhaXNOYU4ocGFyc2VJbnQodmFsdWUsIDEwKSkgJiYgaXNGaW5pdGUodmFsdWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyBmdW5jdGlvbidzIHZhbHVlIGlmIHR5cGUgaXMgZnVuY3Rpb24gb3RoZXJ3aXNlIHNhbWUgdmFsdWVcbiAgICovXG4gIHN0YXRpYyBnZXRWYWx1ZSh2YWx1ZTogYW55KTogYW55IHtcbiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nID8gdmFsdWUoKSA6IHZhbHVlO1xuICB9XG5cbiAgcHJpdmF0ZSBmaWx0ZXJCeVN0cmluZyhmaWx0ZXI6IHN0cmluZykge1xuICAgIGlmIChmaWx0ZXIpIHtcbiAgICAgIGZpbHRlciA9IGZpbHRlci50b0xvd2VyQ2FzZSgpO1xuICAgIH1cbiAgICByZXR1cm4gKHZhbHVlOiBhbnkpID0+XG4gICAgICAhZmlsdGVyIHx8XG4gICAgICAodmFsdWUgPyAoJycgKyB2YWx1ZSkudG9Mb3dlckNhc2UoKS5pbmRleE9mKGZpbHRlcikgIT09IC0xIDogZmFsc2UpO1xuICB9XG5cbiAgcHJpdmF0ZSBmaWx0ZXJCeUJvb2xlYW4oZmlsdGVyOiBib29sZWFuKSB7XG4gICAgcmV0dXJuICh2YWx1ZTogYW55KSA9PiBCb29sZWFuKHZhbHVlKSA9PT0gZmlsdGVyO1xuICB9XG5cbiAgcHJpdmF0ZSBmaWx0ZXJCeU9iamVjdChmaWx0ZXI6IGFueSkge1xuICAgIHJldHVybiAodmFsdWU6IGFueSkgPT4ge1xuICAgICAgZm9yIChjb25zdCBrZXkgaW4gZmlsdGVyKSB7XG4gICAgICAgIGlmIChrZXkgPT09ICckb3InKSB7XG4gICAgICAgICAgaWYgKCF0aGlzLmZpbHRlckJ5T3IoZmlsdGVyLiRvcikoRmlsdGVyUGlwZS5nZXRWYWx1ZSh2YWx1ZSkpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF2YWx1ZSB8fCAhRmlsdGVyUGlwZS5pc0ZvdW5kT25XYWxraW5nKHZhbHVlLCBrZXkpKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0aGlzLmlzTWF0Y2hpbmcoZmlsdGVyW2tleV0sIEZpbHRlclBpcGUuZ2V0VmFsdWUodmFsdWVba2V5XSkpKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGlzTWF0Y2hpbmcoZmlsdGVyOiBhbnksIHZhbDogYW55KSB7XG4gICAgc3dpdGNoICh0eXBlb2YgZmlsdGVyKSB7XG4gICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyQnlCb29sZWFuKGZpbHRlcikodmFsKTtcbiAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgIHJldHVybiB0aGlzLmZpbHRlckJ5U3RyaW5nKGZpbHRlcikodmFsKTtcbiAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgIHJldHVybiB0aGlzLmZpbHRlckJ5T2JqZWN0KGZpbHRlcikodmFsKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZmlsdGVyRGVmYXVsdChmaWx0ZXIpKHZhbCk7XG4gIH1cblxuICAvKipcbiAgICogRmlsdGVyIHZhbHVlIGJ5ICRvclxuICAgKi9cbiAgcHJpdmF0ZSBmaWx0ZXJCeU9yKGZpbHRlcjogYW55W10pOiAodmFsdWU6IGFueSkgPT4gYm9vbGVhbiB7XG4gICAgcmV0dXJuICh2YWx1ZTogYW55KSA9PiB7XG4gICAgICBjb25zdCBsZW5ndGggPSBmaWx0ZXIubGVuZ3RoO1xuXG4gICAgICBjb25zdCBhcnJheUNvbXBhcmlzb24gPSAoaTogYW55KSA9PiB2YWx1ZS5pbmRleE9mKGZpbHRlcltpXSkgIT09IC0xO1xuICAgICAgY29uc3Qgb3RoZXJDb21wYXJpc29uID0gKGk6IGFueSkgPT4gdGhpcy5pc01hdGNoaW5nKGZpbHRlcltpXSwgdmFsdWUpO1xuICAgICAgY29uc3QgY29tcGFyaXNvbiA9IEFycmF5LmlzQXJyYXkodmFsdWUpXG4gICAgICAgID8gYXJyYXlDb21wYXJpc29uXG4gICAgICAgIDogb3RoZXJDb21wYXJpc29uO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChjb21wYXJpc29uKGkpKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogRGVmYXVsdCBmaWx0ZXJEZWZhdWx0IGZ1bmN0aW9uXG4gICAqL1xuICBwcml2YXRlIGZpbHRlckRlZmF1bHQoZmlsdGVyOiBhbnkpOiAodmFsdWU6IGFueSkgPT4gYm9vbGVhbiB7XG4gICAgcmV0dXJuICh2YWx1ZTogYW55KSA9PiBmaWx0ZXIgPT09IHVuZGVmaW5lZCB8fCBmaWx0ZXIgPT0gdmFsdWU7XG4gIH1cblxuICB0cmFuc2Zvcm0oYXJyYXk6IGFueVtdLCBmaWx0ZXI6IGFueSk6IGFueSB7XG4gICAgaWYgKCFhcnJheSkge1xuICAgICAgcmV0dXJuIGFycmF5O1xuICAgIH1cblxuICAgIHN3aXRjaCAodHlwZW9mIGZpbHRlcikge1xuICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgIHJldHVybiBhcnJheS5maWx0ZXIodGhpcy5maWx0ZXJCeUJvb2xlYW4oZmlsdGVyKSk7XG4gICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICBpZiAoRmlsdGVyUGlwZS5pc051bWJlcihmaWx0ZXIpKSB7XG4gICAgICAgICAgcmV0dXJuIGFycmF5LmZpbHRlcih0aGlzLmZpbHRlckRlZmF1bHQoZmlsdGVyKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFycmF5LmZpbHRlcih0aGlzLmZpbHRlckJ5U3RyaW5nKGZpbHRlcikpO1xuICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgcmV0dXJuIGFycmF5LmZpbHRlcih0aGlzLmZpbHRlckJ5T2JqZWN0KGZpbHRlcikpO1xuICAgICAgY2FzZSAnZnVuY3Rpb24nOlxuICAgICAgICByZXR1cm4gYXJyYXkuZmlsdGVyKGZpbHRlcik7XG4gICAgfVxuICAgIHJldHVybiBhcnJheS5maWx0ZXIodGhpcy5maWx0ZXJEZWZhdWx0KGZpbHRlcikpO1xuICB9XG59XG4iXX0=